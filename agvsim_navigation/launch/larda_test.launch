<launch>

    <param name="/use_sim_time" value="false"/>

    <!-- 设置地图的配置文件 -->
    <arg name="map" default="real_map.yaml" />
    <!-- 运行地图服务器，并且加载设置的地图-->
    <node name="map_server" pkg="map_server" type="map_server" args="$(find agvsim_navigation)/maps/real_map.yaml">
        <param name="frame_id" value="map"></param>
    </node>

      <!-- urdf参数 -->
  <!-- 加载机器人参数 -->
  <param name="robot_description" textfile="$(find agv_real)/urdf/agv_real.urdf" />


  <!-- <node pkg="joint_state_publisher" name="joint_state_publisher" type="joint_state_publisher"/> -->
  <node pkg="robot_state_publisher" name="robot_state_publisher" type="robot_state_publisher" />
    

    <!-- 启动AMCL定位节点 -->
    <include file="$(find agvsim_navigation)/launch/amcl.launch" />
    <!-- 运行rviz -->
    <node pkg="rviz" type="rviz" name="rviz" args="-d $(find agvsim_navigation)/rviz/navigation.rviz" output="screen"/>
    <!-- 参数实时修改 -->
    <node pkg="rqt_reconfigure" type="rqt_reconfigure" name="rqt_reconfigure" />
    
     <!-- 启动局部规划器和全局规划器 -->
    <!-- <include file="$(find agvsim_navigation)/launch/move_base.launch" /> -->

    <!-- 几何参数 -->
    <rosparam file="$(find agv_sim_roscontrol)/config/agv_geometry_param_new.yaml" command="load"></rosparam>
    <!-- 硬件抽象层关节信息加载 -->
    <rosparam file="$(find agv_hw)/config/agv_hw.yaml" command="load"></rosparam>
  
  <arg name="lidar_hostname1" default="192.168.1.51" />
  <arg name="lidar_hostname2" default="192.168.1.52" />
  <arg name="serial_no_1" default="332522071089" />
  <arg name="serial_no_2" default="332522072143" />

  <!-- 启动雷达 -->

  <!-- 启动激光雷达1,2 -->
  <include file="$(find sick_scan)/launch/sick_tim_5xx_twin.launch">
    <arg name="hostname1" value="$(arg lidar_hostname1)" />
    <arg name="hostname2" value="$(arg lidar_hostname2)" />
  </include>

  <!-- 启动激光雷达融合 -->
  <node pkg="ira_laser_tools" name="laserscan_multi_merger" type="laserscan_multi_merger"
    output="screen">
    <param name="destination_frame" value="base_footprint" />
    <param name="cloud_destination_topic" value="/merged_cloud" />
    <param name="scan_destination_topic" value="/scan" />
    <param name="laserscan_topics" value="/scan_1 /scan_2" />
    <param name="angle_min" value="-2.7" />
    <param name="angle_max" value="2.7" />
  </node>
  

    
     <!-- 加载控制器，一定不能用ns参数，直接用绝对参数路径才能搞定 -->
    <node name="controller_spawner" pkg="controller_manager" type="spawner" respawn="true"
    output="screen" ns="/" args="
      /agv_sim/turn_wheels_controller" />


  <!-- <node pkg="tf" type = "static_transform_publisher" name="static_transform_publisher" args="0 0 0 0 0 0 1 map odom 100"/> -->

  <node pkg="robot_pose_ekf" type="robot_pose_ekf" name="robot_pose_ekf">
    <param name="output_frame" value="odom_com" />
    <param name="base_footprint_frame" value="base_footprint" />
    <param name="freq" value="300.0" />
    <param name="sensor_timeout" value="1.0" />
    <param name="odom_used" value="true" />
    <param name="imu_used" value="true" />
    <param name="vo_used" value="false" />
    <param name="topic_imu" value="/IMU_data" />
  </node>



</launch>
